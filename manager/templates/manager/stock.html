{% extends 'manager/base.html' %}
{% block title %}Chick Stock{% endblock %}
{% block content %}
<h2 class="mb-1">üê£ Chick Stock</h2>

{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  {% endfor %}
{% endif %}


<p class="text-muted mb-4">Manage all current chick stock in the brooder.</p>

<!-- Tabs -->
<ul class="nav nav-tabs mb-4" id="chickStockTabs" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="summary-tab" data-toggle="tab" href="#summary" role="tab">‚ûï Add + Summary</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="all-tab" data-toggle="tab" href="#all" role="tab">üì¶ All Stock Entries</a>
  </li>
</ul>

<div class="tab-content" id="chickStockTabsContent">

  <!-- Tab 1: Add + Summary -->
  <div class="tab-pane fade show active" id="summary" role="tabpanel">
    <!-- Stock Entry Form -->
    <div class="card p-4 mb-4">
      <h5 class="mb-3">‚ûï Add New Chick Batch</h5>
      <form method="post" action="{% url 'manager_chick_stock' %}">
        {% csrf_token %}
        <div class="form-row">
          <div class="form-group col-md-4">
            <label>Chick Type</label>
            <select class="form-control" name="chick_type" required>
              <option selected disabled>Choose...</option>
              <option value="broiler_local">Broilers Local</option>
              <option value="broiler_exotic">Broilers Exotic</option>
              <option value="layer_local">Layers Local</option>
              <option value="layer_exotic">Layers Exotic</option>
            </select>
          </div>
          <div class="form-group col-md-4">
            <label>Quantity</label>
            <input type="number" name="quantity" class="form-control" required>
          </div>
          <div class="form-group col-md-4">
            <label>Age (in days)</label>
            <input type="number" name="age_days" class="form-control" required>
          </div>
        </div>
        <div class="form-group">
          <label>Notes (optional)</label>
          <textarea class="form-control" name="notes" rows="2"></textarea>
        </div>
        <button class="btn btn-success mt-2">Add to Stock</button>
      </form>
    </div>

    <!-- Summary Table -->
    <div class="card p-4">
      <h5 class="mb-3">üìä Stock Summary by Type & Status</h5>
      <div class="table-responsive">
        <table class="table table-bordered table-sm">
          <thead class="thead-light">
            <tr>
              <th>Chick Type</th>
              <th>Total</th>
              <th>Available (‚â§14d)</th>
              <th>Aging (15‚Äì21d)</th>
              <th>Expiring (22+d)</th>
            </tr>
          </thead>
          <tbody>
            {% for type in summary %}
            <tr>
              <td>{{ type.label }}</td>
              <td>{{ type.total }}</td>
              <td>{{ type.available }}</td>
              <td>{{ type.aging }}</td>
              <td>{{ type.expiring }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Tab 2: All Entries -->
  <div class="tab-pane fade" id="all" role="tabpanel">
    <div class="card p-4 mt-4">
      <h5 class="mb-3">üì¶ Current Chick Stock Entries</h5>
      <div class="table-responsive">
        <table class="table table-sm table-bordered table-hover mb-0">
          <thead class="thead-light">
            <tr>
              <th>Batch ID</th>
              <th>Type</th>
              <th>Quantity</th>
              <th>Age (Days)</th>
              <th>Recorded On</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for batch in page_obj %}
            <tr>
              <td class="align-middle">Batch: {{ batch.id }}</td>
              <td class="align-middle">{{ batch.get_chick_type_display }}</td>
              <td class="align-middle">{{ batch.quantity }}</td>
              <td class="align-middle">{{ batch.age_days }}</td>
              <td class="align-middle">{{ batch.recorded_on|date:"M d, Y" }}</td>
              <td class="text-center align-middle">
                {% if batch.age_days <= 14 %}
                <span class="badge badge-success">Available</span>
                {% elif batch.age_days <= 21 %}
                <span class="badge badge-warning text-dark">Aging</span>
                {% else %}
                <span class="badge badge-danger">Expiring Soon</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center text-muted">No chick stock available.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <!-- Pagination -->
        <div class="mt-4 text-center">
          <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
              {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
              </li>
              {% else %}
              <li class="page-item disabled"><a class="page-link">Previous</a></li>
              {% endif %}

              {% for num in page_obj.paginator.page_range %}
              <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
              </li>
              {% endfor %}

              {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
              </li>
              {% else %}
              <li class="page-item disabled"><a class="page-link">Next</a></li>
              {% endif %}
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

<p class="text-muted mt-4">Older batches above 21 days may require special handling or faster approval.</p>
{% endblock %}

